"use strict";var h=Object.create;var c=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var I=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of v(t))!y.call(e,r)&&r!==o&&c(e,r,{get:()=>t[r],enumerable:!(s=u(t,r))||s.enumerable});return e};var a=(e,t,o)=>(o=e!=null?h(w(e)):{},I(t||!e||!e.__esModule?c(o,"default",{value:e,enumerable:!0}):o,e));var b=require("dotenv/config"),d=a(require("http"));var i=a(require("axios")),p=a(require("archiver")),m=`Bearer ${process.env.TOKEN}`,A=process.env.ACCOUNT_ID,z=async()=>(await i.default.get(`https://api.cloudflare.com/client/v4/accounts/${A}/images/v2`,{headers:{Authorization:m}})).data,x=async(e,t,o)=>{let s=`https://imagedelivery.net/DnKUqTjrmqfvonSskl9WBQ/${t}/raw`,r=await i.default.get(s,{headers:{Authorization:m},responseType:"arraybuffer"});e.append(Buffer.from(r.data),{name:o})},g=async e=>{let{result:t}=await z();console.log("Started Process..."),console.time("zip");let o=(0,p.default)("zip",{zlib:{level:9}});o.pipe(e),o.on("error",n=>{throw n});let s=t.images.length,r=100;for(let n=0;n<s;n+=r){let f=t.images.slice(n,n+r);console.log(`Index ${n+r} of ${s}`),await Promise.all(f.map(l=>x(o,l.id,l.filename)))}o.on("finish",()=>{console.log("Finish"),e.end()}),o.on("progress",({entries:n})=>console.log(n)),await o.finalize(),console.timeEnd("zip")};d.default.createServer(async(e,t)=>{if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","*"),console.log("\u{1F680} ~ server ~ request.url:",e.url),e.url!=="/download")return t.writeHead(200).end("hey there");t.writeHead(200,{"Content-Type":"application/zip","Content-Disposition":`attachment; filename="${Date.now().toString(16)}.zip"`}),await g(t)}).listen(process.env.PORT,()=>console.log(`Server is up on port ${process.env.PORT}`));
